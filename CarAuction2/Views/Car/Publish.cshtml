@model CarAuction2.Models.Car.Car

@{
    ViewBag.Title = "Publish a car";
    Layout = "~/Views/Shared/_PanelLayout.cshtml";
}
<div class="row">
    <div class="col-md-9">
        <h2>@ViewBag.Title</h2>
    </div>
    <div class="col-md-3 text-md-right">
        <a class="btn" href="/Car/MyCars">Back</a>
    </div>
</div>
@using (Html.BeginForm("Publish", "Car", FormMethod.Post))
{
    if (ViewBag.FailureMessage != null)
    {
        @ValidationExtensions.ValidationSummary(Html, false, @ViewBag.FailureMessage, new {@class = "alert alert-danger"})
    }
    <div id="SuccessMessage" class="alert alert-success" style="display: none;">
        <h4 class="alert-heading">Well done!</h4>
        Your car has been successfully published
        <hr />
        When someone makes an offer we will send you a notification
    </div>
    <div class="form-group">
        @Html.Label("Mark")
        @Html.DropDownList(
            "Mark",
            new SelectList(ViewBag.Marks, "MarkId", "Name"),
            "Select a mark",
            new {id = "MarkId", @class = "form-control"})
    </div>
    <div class="form-group" style="display: none;">
        @Html.LabelFor(m => m.Model)
        @Html.DropDownListFor(
            m => m.ModelId,
            new SelectList(ViewBag.Models, "ModelId", "Name"),
            "Select a model",
            new {id = "ModelId", @class = "form-control"})
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.ProductionYear)
        @Html.TextBoxFor(m => m.ProductionYear, new {@class = "form-control", type="number"})
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.Mileage)
        <div class="input-group mb-3">
            @Html.TextBoxFor(m => m.Mileage, new {@class = "form-control", type="number"})
            <div class="input-group-append">
                <span class="input-group-text">km</span>
            </div>
        </div>
        
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.DesiredPrice)
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">$</span>
            </div>
            @Html.TextBoxFor(m => m.DesiredPrice, new {@class = "form-control", type = "number"})
            <div class="input-group-append">
                <span class="input-group-text">.00</span>
            </div>
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.Description)
        @Html.TextAreaFor(m => m.Description, new {@class = "form-control"})
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.CarStatus)
        @Html.EnumDropDownListFor(m => m.CarStatus, new {@class = "form-control"})
    </div>
    <button id="AddCarButton" class="btn btn-primary" type="button">Add a car</button>
    <script>

        $(function() {
            $("#AddCarButton").click(function(e) { 
                var jsonObject = {
                    "ModelId": $("#ModelId").val(),
                    "ProductionYear": $("#ProductionYear").val(),
                    "Mileage": $("#Mileage").val(),
                    "DesiredPrice": $("#DesiredPrice").val(),
                    "Description": $("#Description").val(),
                    "CarStatus": $("#CarStatus").val()
                };

                $.ajax({
                    url: "@Url.Action("Publish")",
                    type: "POST",
                    data: JSON.stringify(jsonObject),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    error: function(response) {
                        var r = $.parseJSON(response);
                        console.log(r);
                    },
                    success: function(response) {
                        var r = $.parseJSON(response);
                        if (r == true) {
                            $("#SuccessMessage").show();
                        } else {
                            // Todo validation
                            console.log("Failure");
                        }
                    }
                });
            });
        });

    </script>
    @Scripts.Render("~/bundles/afterload.js")
}